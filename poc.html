<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aventuras Fant√°sticas - A Cidadela do Caos</title>
  <link rel="stylesheet" href="estilo.css">
  <script src="jquery-3.3.1.min.js"></script>
  <script src="p5.js"></script>
  <script src="p5.dom.js"></script>
  <script src="dado.js"></script>
  <script src="sketch.js"></script>
</head>

<body>
 
<!--
    <div class="area">
        <section class="area-book">
            <div class="opaco"></div>
            <div class="conteudo">
                <p class="texto">Conteudo exemplo</p>
                <div class="questoes">

                </div>
            </div>
        </section>
        <div class="area-img">
            <div class="opaco"></div>
            <img id="painel-img">
        
        </div>
    </div>
-->
    
    
    <div id="wrapper">
    <div id="container">

        <section class="open-book">
            <header>
                <h1>Book Layout</h1>
                <h6>Erin E. Sullivan</h6>
            </header>
            <article>
                <div class="pagina-texto">
                    <p class="texto">
                    </p>
                    <ul class="opcoes">
                        
                    </ul>
                </div>
                <div class="pagina-img">
                    <img src="" id="painel-img">
                </div>
            </article>
            <footer>
                <ol id="page-numbers">
                    <li>1</li>
                    <li>2</li>
                </ol>
            </footer>
        </section>


        <div class="combate-container">
            <h1 class="token-turno">Sua vez</h1>
            <div class="ficha-heroi">
                <h3 class="heroi-nome">Alucard</h3>
                <ul class="heroi-status">
                    <li class="heroi-energia">Energia<span class="box">12</span></li>
                    <li class="heroi-habilidade">Habilidade<span class="box">12</span></li>
                    <li class="heroi-sorte">Sorte<span class="box">12</span></li>
                </ul>
            </div>
            <div id="area-sketch"></div>
            <div class="ficha-inimigo">
                <h3 class="inimigo-nome">Cerberus</h3>
                <ul class="inimigo-status">
                    <li class="inimigo-energia">Energia<span class="box">12</span></li>
                    <li class="inimigo-habilidade">Habilidade<span class="box">12</span></li>
                    <li class="inimigo-sorte">Sorte<span class="box">12</span></li>
                </ul>
            </div>

        </div>

    </div>
</div>
    <script>

        var char_status = {nome:"Alucard",energia:12,habilidade:7,sorte:6};

        $.getJSON('https://api.myjson.com/bins/10q8qq', function(data){
            livrocompleto = data;
            pagina_start = 1;
            var teste;
                        
            atualizaPagina(retornaPagina(pagina_start));
        }),'jsonp';   
             
        function retornaPagina(page){
            return(livrocompleto.pagina[page-1]);
        }
        
        function atualizaPagina(page){
            $(".texto").text(page.texto);
            
            if(page.questoes.length>0){
                var pai = $(".open-book .pagina-texto .opcoes");
                pai.empty();
                
                for(i=0;i<page.questoes.length;i++){
                    var filho = document.createElement('l1');
                    filho.className += "questao";
                    $(filho).attr("data-destino",page.questoes[i].destino);
                    filho.textContent = page.questoes[i].mensagem;
                    pai.append(filho);
                }
            }
            
            if(page.imagem!=null){
                $("#painel-img").attr("src","img/"+page.imagem);
            }
            else{
                $("#painel-img").attr("src","img/1.jpg");
            }
            
            if(page.combate){
                console.log("Prepare for battle!");
                $(".combate-container").css("display","flex");
                limpaDados();
                criaDados(5);
                rolarDado();
                pipefile.push("15");
            }
            else{
                $(".combate-container").css("display","none");
            }
        }
        
//        function atualizaPagina(gotopage){
//            var atualizada = livrocompleto.pagina[gotopage-1];
//            $(".texto").text = atualizada.texto;
//        }
        
        $(document).on("click", ".questao", function(){
            var vapara = $(this).attr("data-destino");
            console.log(vapara);
            atualizaPagina(retornaPagina(vapara));
            
        });
        
    </script>
    
</body>
</html>
